Задание 4. Трассировка лучей.
Батанов Павел Георгиевич 321 Группа
СП - Qt 4.7.0 32bit 
ОС Win7 x64 Prof, Ubuntu 10.10 x64 Desktop

Обязательная часть задания [+]
+ Дополнительная часть, качество [+]
|	+ Текстурирование: [+]
|	+ Тени:
|		- Жесткие [+]
|	Преломления [+]
|	+ Реализация микрорельефа:
|	- Bump mapping с помощью карт нормалей [+]
|	+ Приятное впечатление :)
+ Дополнительная часть, функциональность [+]
|	+ GUI для управления сценой:
|	|	- управление камерой производится кнопками WASD, QE(zoom), R(reset zoom), Space - переключить режим Preview\Render. 
|	|		Часть функционала продуюлирована на форме управления сценой.
|	+ GUI для настроек рендера
|	|	- разрешение меняется ресайзом окна (стандартное 1024*768)
|	|	- U для сохранения картинки в файл output.png
|	+ GUI для настройек материалов, света, текстур и объектов
|	|	- может не все так интуитивно как в 3дмаксе, но вроде юзать можно
|	|	- сохранение не работает (сериализацию еще не сделал). загрузка тоже
|	+ Виды объектов:
|		- Плоскость
|		- Шар (произвольный эллипсоид)
|		- Цилиндр с эллиптическим основанием
|		- Конус с эллиптическим основанием
|		- Плоский диск
|		- Плоский прямоугольник
+ Дополнительная часть, скорость [+]
	- Многопоточногсть на CPU (OpenMP)[+]
	- Агрессивные оптимизации компилятором
	
В программе реализованы следующие виды текстур
	Solid Color
	Image
	Mask Mix (смешиваются две произвольные текстуры по маске)
	NormalMap (генерирует карту нормалей для картинки и кэширует на диск)
	P.S. Так как я не нашел алгоритма построения карты нормалей лучше, чем по краям, то карты нормалей используемые в сцене сгенерированы сторонней программой.

Реализованы три метода наложения тексур - плоское наложение, цилиндрическое, и сферическое(кубическое доступно но нереализовано).
В программе реализованы произвольные повороты обьектов. 
В связи с этим замечено сильное замедление работы(все таки минимум 9 операций умножения и 6 сложения на каждый луч лишних).

Время работы программы на Core 2 Duo (2 ядра) на изображении 1024*768 - порядка 26-28 секунд (на 34 объекта и 3 источника света). 
По расчетам для заявленом тестовом стенде (Сore 2 Quad) должно быть время порядка 13-16 секунд.


О сцене.

Представлена игрушка а-ля мир внутри стеклянного шарика. Внутри генерируется снеговик, несколько шаров и три елочки. 
Елочки и шары, появляются в случайных местах, и может так случится, что елочка окажется в "сугробе".
Рядом с игушкой поставлено два цветных зеркальных шара, для демонстрации отражений.
Стекло выполнено из преломляющего материала с коэф. преломления 1, чтобы корректно обработать прохождение света через него.
(можно было бы сделать и 1,4 как у настоящего стекла, но тогда бы пришлось усложнять сцену расстановкой освещения внутри шарика или расчетом глобального освещения), 


О гуи.

В режиме предпросмотра снижено качество, не обрабатываются преломления, отражения, тиснение. Расчитывается только модель фонга. 
В режиме предпросмотра изображение перерисовывается по каждому событию (будте осторонжны на больших разрешениях).
В режиме рендера все кнопки кроме сохранения и переключения в режим предпросмотра отключаются.
В коде рендера закомментирована строчка, с помощью которой (при необходимости) можно просмотреть карту нормалей.


О таймере отрисовки.
Винда считает приложения, которые не отвечают на системые сигналы дольше 5000 мс, зависщими. 
Поэтому при первом долгом рендере приложение будет показываться как зависшее (Винда заблокирует окно приложения).
Отвисает почему то за несколько секунд до конца рендера.

В папке bin приложен рендер сценки. output.png

О компиляции.

Для компиляции приложения нужен последний mingw с gcc >= 4.5
Без него приложение скомпилируется, но при старте будет выпадать с ошибкой.
Это нужно для поддержки OpenMP. Скачать новый mingw можно здесь
http://sourceforge.net/projects/mingw/files/Automated%20MinGW%20Installer/mingw-get-inst/mingw-get-inst-20101030/mingw-get-inst-20101030.exe/download
Установить в Qt SDK вместо старого. Ну или вместо страрого mingw, используемого вами.

О запуске.

Я не стал прикладывать библиотеки Qt для запуска, потому что они много весят.

О праке.

Прак будет выслан позже

Вроде бы все.